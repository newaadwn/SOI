rules_version = '2';

// Firebase Storage 보안 규칙 - 사진/오디오 업로드 허용
service firebase.storage {
  match /b/{bucket}/o {
    // 사진 파일 (photos 폴더) - 인증된 사용자만 업로드, 모든 사용자 읽기 가능
    match /photos/{fileName} {
      allow read: if true; // 모든 사용자가 사진 읽기 가능
      allow write: if request.auth != null; // 인증된 사용자만 업로드 가능
    }
    
    // 오디오 파일 (audio 폴더) - 인증된 사용자만 업로드, 모든 사용자 읽기 가능
    match /audio/{fileName} {
      allow read: if true; // 모든 사용자가 오디오 읽기 가능  
      allow write: if request.auth != null; // 인증된 사용자만 업로드 가능
    }
    
    // 사용자 프로필 이미지 (profiles 폴더) - 공개 읽기, 소유자만 쓰기
    match /profiles/{userId}/{allPaths=**} {
      allow read: if true; // 모든 사용자가 프로필 이미지 읽기 가능
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 사용자별 개인 파일 (users 폴더) - 소유자만 접근
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 음성 댓글 파일 (comment_records 폴더)
    match /comment_records/{allPaths=**} {
      allow read: if true; // 모든 사용자가 읽기 가능
      allow write: if request.auth != null; // 인증된 사용자만 업로드 가능
    }
    
    // 임시 파일 (temp 폴더) - 소유자만 접근
    match /temp/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 기타 모든 파일은 차단 (보안상 안전)
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}