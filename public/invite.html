<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SOI ì¹œêµ¬ ì´ˆëŒ€</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Open Graph ë©”íƒ€ë°ì´í„° -->
    <meta property="og:title" content="SOI ì¹œêµ¬ ì´ˆëŒ€" />
    <meta property="og:description" content="SOIì—ì„œ ì¹œêµ¬ê°€ ë˜ê³  ì‹¶ì–´í•´ìš”!" />
    <meta property="og:image" content="https://soi-sns.web.app/assets/SOI_logo.png" />
    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="SOI ì¹œêµ¬ ì´ˆëŒ€" />
    <meta name="twitter:description" content="SOIì—ì„œ ì¹œêµ¬ê°€ ë˜ê³  ì‹¶ì–´í•´ìš”!" />
    <meta name="twitter:image" content="https://soi-sns.web.app/assets/SOI_logo.png" />
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; 
            text-align: center; 
            padding: 50px 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
        }
        .soi-logo { 
            width: 120px; 
            margin-bottom: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .invite-message { 
            font-size: 18px; 
            margin-bottom: 30px; 
            line-height: 1.5;
            color: #333;
        }
        .inviter-info {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }
        .download-btn { 
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 50px; 
            font-size: 16px; 
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            width: 100%;
        }
        .download-btn:hover {
            transform: translateY(-2px);
        }
        .loading {
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="/assets/SOI_logo.png" alt="SOI" class="soi-logo">
        <div id="inviterInfo" class="inviter-info"></div>
        <div id="inviteMessage" class="invite-message">
            SOI ì•±ì—ì„œ ì¹œêµ¬ ìš”ì²­ì´ ì™”ì–´ìš”!
        </div>
        <button id="downloadBtn" class="download-btn">SOI ì•± ì—´ê¸°</button>
        <div id="loading" class="loading" style="display: none;">
            ì•±ì„ í™•ì¸í•˜ëŠ” ì¤‘...
        </div>
    </div>
    
    <script>
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì •ë³´ ì¶”ì¶œ
        const urlParams = new URLSearchParams(window.location.search);
        const inviterName = urlParams.get('inviter') || 'ì¹œêµ¬';
        const inviterId = urlParams.get('inviterId') || '';
        const inviteeName = urlParams.get('invitee') || 'ë‹¹ì‹ ';
        
        // í˜ì´ì§€ ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
        document.title = `${inviterName}ë‹˜ì˜ SOI ì¹œêµ¬ ì´ˆëŒ€`;
        document.querySelector('meta[property="og:title"]').content = `${inviterName}ë‹˜ì˜ SOI ì¹œêµ¬ ì´ˆëŒ€`;
        document.querySelector('meta[property="og:description"]').content = `${inviterName}ë‹˜ì´ SOIì—ì„œ ${inviteeName}ë‹˜ê³¼ ì¹œêµ¬ê°€ ë˜ê³  ì‹¶ì–´í•´ìš”!`;
        
        // ë©”ì‹œì§€ ê°œì¸í™”
        document.getElementById('inviterInfo').textContent = `${inviterName}ë‹˜ìœ¼ë¡œë¶€í„°`;
        document.getElementById('inviteMessage').textContent = 
            `SOIì—ì„œ ${inviteeName}ë‹˜ê³¼ ì¹œêµ¬ê°€ ë˜ê³  ì‹¶ì–´í•´ìš”!`;
        
        // í”Œë«í¼ë³„ ë‹¤ìš´ë¡œë“œ URL
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        // ì•± ì„¤ì¹˜ ê°ì§€ ë° ë”¥ë§í¬ í•¨ìˆ˜
        function tryOpenApp(deepLinkUrl, storeUrl) {
            const loading = document.getElementById('loading');
            const btn = document.getElementById('downloadBtn');
            
            loading.style.display = 'block';
            btn.textContent = 'ì•± í™•ì¸ ì¤‘...';
            
            let appOpened = false;
            const startTime = Date.now();
            
            // Page visibility ë³€í™” ê°ì§€
            const handleVisibilityChange = () => {
                if (document.hidden) {
                    appOpened = true;
                    console.log('âœ… ì•±ì´ ì—´ë ¸ìŠµë‹ˆë‹¤');
                }
            };
            
            // Page focus ë³€í™” ê°ì§€
            const handleFocusChange = () => {
                if (!document.hasFocus()) {
                    appOpened = true;
                    console.log('âœ… ì•±ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            };
            
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('blur', handleFocusChange);
            
            // ë”¥ë§í¬ ì‹œë„
            console.log(`ğŸ”— ë”¥ë§í¬ ì‹œë„: ${deepLinkUrl}`);
            window.location.href = deepLinkUrl;
            
            // 3ì´ˆ í›„ ì•±ì´ ì—´ë¦¬ì§€ ì•Šì•˜ìœ¼ë©´ ìŠ¤í† ì–´ë¡œ ì´ë™
            setTimeout(() => {
                document.removeEventListener('visibilitychange', handleVisibilityChange);
                window.removeEventListener('blur', handleFocusChange);
                
                if (!appOpened) {
                    console.log('âŒ ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ - ìŠ¤í† ì–´ë¡œ ì´ë™');
                    btn.textContent = 'ì•± ë‹¤ìš´ë¡œë“œí•˜ëŸ¬ ê°€ê¸°';
                    window.location.href = storeUrl;
                } else {
                    loading.style.display = 'none';
                    btn.textContent = 'ì•±ì´ ì—´ë ¸ìŠµë‹ˆë‹¤!';
                }
            }, 3000);
        }
        
        document.getElementById('downloadBtn').onclick = function() {
            const deepLinkData = `?inviter=${encodeURIComponent(inviterName)}&inviterId=${encodeURIComponent(inviterId)}&invitee=${encodeURIComponent(inviteeName)}`;
            
            if (isAndroid) {
                // Android: Intent URL
                const intentUrl = `intent://invite${deepLinkData}#Intent;scheme=soi;package=com.soi.app;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.soi.app;end`;
                const playStoreUrl = 'https://play.google.com/store/apps/details?id=com.soi.app';
                
                tryOpenApp(intentUrl, playStoreUrl);
            } else if (isIOS) {
                // iOS: Custom URL Scheme
                const deepLinkUrl = `soi://invite${deepLinkData}`;
                const appStoreUrl = 'https://apps.apple.com/app/soi/idì—¬ê¸°ì—ì•±ID';
                
                tryOpenApp(deepLinkUrl, appStoreUrl);
            } else {
                // ì›¹: í”Œë ˆì´ìŠ¤í† ì–´ë¡œ
                window.location.href = 'https://play.google.com/store/apps/details?id=com.soi.app';
            }
        };
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì ì‹œ í›„ ìë™ìœ¼ë¡œ ì•± ì—´ê¸° ì‹œë„
        window.addEventListener('load', () => {
            setTimeout(() => {
                // URLì— auto=1 íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ìë™ ì‹¤í–‰
                if (urlParams.get('auto') === '1') {
                    document.getElementById('downloadBtn').click();
                }
            }, 1000);
        });
    </script>
</body>
</html>