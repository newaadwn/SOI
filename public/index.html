<!-- public/invite.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SOI ì´ˆëŒ€</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
        .soi-logo { width: 120px; margin-bottom: 30px; }
        .invite-message { font-size: 18px; margin-bottom: 30px; }
        .download-btn { 
            background: #1976d2; color: white; padding: 15px 30px; 
            border: none; border-radius: 8px; font-size: 16px; cursor: pointer;
        }
    </style>
</head>
<body>
    <img src="/assets/SOI_logo.png" alt="SOI" class="soi-logo">
    <div id="inviteMessage" class="invite-message">
        SOI ì•±ì—ì„œ ì¹œêµ¬ ìš”ì²­ì´ ì™”ì–´ìš”!
    </div>
    <button id="downloadBtn" class="download-btn">ì•± ë‹¤ìš´ë¡œë“œ</button>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const inviterName = urlParams.get('inviter') || 'ì¹œêµ¬';
        const inviterId = urlParams.get('inviterId');
        const inviteeName = urlParams.get('invitee');
        
        // ë©”ì‹œì§€ ê°œì¸í™”
        document.getElementById('inviteMessage').textContent = 
            `${inviterName}ë‹˜ì´ SOIì—ì„œ ì¹œêµ¬ ìš”ì²­ì„ ë³´ëƒˆì–´ìš”!`;
        
        // í”Œë«í¼ë³„ ë‹¤ìš´ë¡œë“œ
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        // ğŸ”¥ ì•± ì„¤ì¹˜ ê°ì§€ ê°•í™” í•¨ìˆ˜
        function tryOpenApp(deepLinkUrl, storeUrl) {
            let appOpened = false;
            const startTime = Date.now();
            
            // Page visibility ë³€í™” ê°ì§€
            const handleVisibilityChange = () => {
                if (document.hidden) {
                    appOpened = true;
                    console.log('âœ… ì•±ì´ ì—´ë ¸ìŠµë‹ˆë‹¤');
                }
            };
            
            // Page focus ë³€í™” ê°ì§€ (ì¶”ê°€ í™•ì¸)
            const handleFocusChange = () => {
                if (!document.hasFocus()) {
                    appOpened = true;
                    console.log('âœ… ì•±ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            };
            
            document.addEventListener('visibilitychange', handleVisibilityChange);
            window.addEventListener('blur', handleFocusChange);
            
            // ë”¥ë§í¬ ì‹œë„
            console.log(`ğŸ”— ë”¥ë§í¬ ì‹œë„: ${deepLinkUrl}`);
            window.location.href = deepLinkUrl;
            
            // 2ì´ˆ í›„ ì•±ì´ ì—´ë¦¬ì§€ ì•Šì•˜ìœ¼ë©´ ìŠ¤í† ì–´ë¡œ ì´ë™
            setTimeout(() => {
                document.removeEventListener('visibilitychange', handleVisibilityChange);
                window.removeEventListener('blur', handleFocusChange);
                
                if (!appOpened) {
                    console.log('âŒ ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ - ìŠ¤í† ì–´ë¡œ ì´ë™');
                    window.location.href = storeUrl;
                }
            }, 2000);
        }
        
        document.getElementById('downloadBtn').onclick = function() {
            const deepLinkData = `?inviter=${inviterName}&inviterId=${inviterId}&invitee=${inviteeName}`;
            
            if (isAndroid) {
                // Android: Intent URLë¡œ ì•± í˜¸ì¶œ ì‹œë„
                const intentUrl = `intent://invite${deepLinkData}#Intent;scheme=soi;package=com.soi.app;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.soi.app;end`;
                const playStoreUrl = 'https://play.google.com/store/apps/details?id=com.soi.app';
                
                tryOpenApp(intentUrl, playStoreUrl);
            } else if (isIOS) {
                // iOS: Custom URL Scheme ì‹œë„
                const deepLinkUrl = `soi://invite${deepLinkData}`;
                const appStoreUrl = 'https://apps.apple.com/app/soi/idì—¬ê¸°ì—ì•±ID';
                
                tryOpenApp(deepLinkUrl, appStoreUrl);
            } else {
                // ì›¹: í”Œë ˆì´ìŠ¤í† ì–´ë¡œ
                window.location.href = 'https://play.google.com/store/apps/details?id=com.soi.app';
            }
        };
        
        // ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì•± ì—´ê¸° ì‹œë„ (ì„ íƒì‚¬í•­)
        window.addEventListener('load', () => {
            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì•± ì—´ê¸° ì‹œë„
            setTimeout(() => {
                document.getElementById('downloadBtn').click();
            }, 1000);
        });
    </script>
</body>
</html>